name: Check Application Status

on:
  workflow_dispatch:

jobs:
  check-status:
    runs-on: ubuntu-latest
    
    steps:
    - name: Check Application Status
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.SERVER_HOST }}
        username: ${{ secrets.SERVER_USERNAME }}
        password: ${{ secrets.SERVER_PASSWORD }}
        port: ${{ secrets.SERVER_PORT }}
        script: |
          echo "=== Checking Application Status ==="
          
          echo "1. Checking PM2 processes..."
          pm2 list
          
          echo "2. Checking port status..."
          netstat -an | findstr :3001
          netstat -an | findstr :3002
          
          echo "3. Checking if directories exist..."
          dir C:\glaz-finance-app
          dir C:\glaz-finance-app\backend
          dir C:\glaz-finance-app\frontend
          
          echo "4. Checking if files exist..."
          if exist "C:\glaz-finance-app\backend\index.js" (
            echo "Backend index.js exists"
          ) else (
            echo "Backend index.js NOT found"
          )
          
          if exist "C:\glaz-finance-app\ecosystem-js.config.js" (
            echo "PM2 config exists"
          ) else (
            echo "PM2 config NOT found"
          )
          
          echo "5. Checking PM2 logs..."
          pm2 logs --lines 10
          
          echo "6. Testing local connections..."
          curl -s http://localhost:3002/health || echo "Backend not responding"
          curl -s http://localhost:3001 || echo "Frontend not responding"
